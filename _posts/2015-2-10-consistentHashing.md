---
layout: post
category: 算法
title: 一致性hash
tagline: by anping
tags: [hash,一致性哈希]
---


简单hash
=======


在编码中最常用的是hash map ,使用的是简单的hash算法,存储之后可以快速的获取需要的get 数据.


假如分布式使用简单hash
==================


在分布式的服务中,hash算法得到了大量的使用.比如memcache集群中,如果需要对一个对象 a存储到memcache中,则需要通过hash(a)%N 的方式获取存储的物理机器对象.


    hash(a) % N  = meachine
    hash():表示hash算法
    a: 表示需要存储的对象
    %: 表示求余
    N: 表示机器的数量
    meachine:表示a存储到第meachine台机器




使用简单hash的问题
===============

假如如上的memcache集群中有一台服务器down了,则 hash(a)%N 就需要变成hash(a)%(N-1).则集群中所有的数据的key都要用以上的方式重新去计算更新一遍.这是一个庞大的消耗效率,不可接受的过程.


一致性hash思路
============

一致性hash 不错的改善了以上的问题.

一致性hash不再是对机器的数量做hash ,而是引入一个 数据圈, 这个数据圈的数据范围是 0~ 2^32-1 .  

*    首先将机器通过hash函数分别映射到数据圈范围内, 然后在将数据映射到圈内,按照顺时针的方式,数据存储在离顺时针最进的一个机器中.
*    当down一台机器时.则只是需要将这台集群中的所有数据全部转移到顺时针的下一台机器即可,并不影响其它的机器的数据(其它机器不需要做任何变动).
*    当新增一台机器时,则只是需要将这个机器和逆时针的下一台机器 这个范围的数据全部转移到新增机器即可,也不影响其它数据.


详细并配图博客推荐:

[一致性hash](http://blog.csdn.net/cywosp/article/details/23397179)
